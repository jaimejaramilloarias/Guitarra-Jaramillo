<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Guitarra Jaramillo</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0d0d0d;--text:#e7e7e7;--accent:#3d7cff;
      --panel:#111;--panel-bd:#2a2a2a;
      --grid:#9a9a9a;               /* ✨ tono más claro para trastes */
      --string:#bdbdbd;             /* color de cuerdas */
      --board1:#5b310e;--board2:#3d2208;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;color:var(--text)}
    body{background:var(--bg);display:flex;flex-direction:column;align-items:center;padding:2rem 1rem;gap:1rem}
    h1{font-size:2.3rem;font-weight:600;color:var(--accent);letter-spacing:.4px}

    /* panel */
    .panel{display:flex;flex-wrap:wrap;gap:1rem;align-items:center;background:var(--panel);border:1px solid var(--panel-bd);padding:1rem 1.5rem;border-radius:12px;box-shadow:0 4px 14px #0007}
    label{font-size:.9rem;white-space:nowrap}
    select,button{background:#000;border:1px solid #444;border-radius:6px;padding:.35rem .7rem;font-size:.9rem;cursor:pointer}
    button{font-weight:600;color:#fff;user-select:none}
    button:active{transform:scale(.92)}
    .btnBox{display:flex;align-items:center;gap:.45rem}

    /* canvas */
    #board{border-radius:14px;background:linear-gradient(var(--board1),var(--board2));box-shadow:inset 0 0 8px #000a;display:block;max-width:100%}

    /* leyenda */
    .legend{display:flex;gap:1.4rem;flex-wrap:wrap;justify-content:center;margin-top:.6rem;font-size:.9rem}
    .legend-item{display:flex;align-items:center;gap:.45rem}
    .dot{width:16px;height:16px;border-radius:50%}
    .g{background:#0f0}.b{background:#08f}.o{background:#f80}.r{background:#f00}

    /* número romano */
    #fretLabel{font-size:2.35rem;font-weight:600;color:var(--accent);margin-top:.45rem;user-select:none}
  </style>
</head>
<body>
  <h1>Guitarra Jaramillo</h1>
  <div class="panel">
    <label>Fundamental</label><select id="root"></select>
    <label>Escala</label><select id="scale"></select>
    <label>Posición</label><select id="pos"></select>
    <label>Trastes</label>
    <div class="btnBox"><button id="minus">−</button><span id="fretVal">16</span><button id="plus">＋</button></div>
  </div>
  <canvas id="board"></canvas>
  <div id="fretLabel">I</div>
  <div class="legend">
    <div class="legend-item"><span class="dot g"></span>Fundamental</div>
    <div class="legend-item"><span class="dot b"></span>Sonido estructural</div>
    <div class="legend-item"><span class="dot o"></span>Tensión disponible</div>
    <div class="legend-item"><span class="dot r"></span>No disponible</div>
  </div>
<script>
/*******************************************************************/
/* Datos básicos */
/*******************************************************************/
const NOTE=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],
      STR_PITCH=[40,45,50,55,59,64],         // 6ª→1ª (E2‑E4)
      STRINGS=6,
      BOARD_H=220,
      TOTAL_FRETS=22;
let   RAD=14,        // ⬆︎ círculos un poco más grandes
      visibleFrets=16;

const SCALE={mayor:[2,2,1,2,2,2,1],mayor_armonica:[2,2,1,2,1,3,1],menor_melodica:[2,1,2,2,2,2,1],menor_armonica:[2,1,2,2,1,3,1],jonico:[2,2,1,2,2,2,1],dorico:[2,1,2,2,2,1,2],frigio:[1,2,2,2,1,2,2],lidio:[2,2,2,1,2,2,1],mixolidio:[2,2,1,2,2,1,2],eolico:[2,1,2,2,1,2,2],locrio:[1,2,2,1,2,2,2],pentatonica_mayor:[2,2,3,2,3],blues:[3,2,1,1,3,2],por_tonos:[2,2,2,2,2,2]};
const SPECIAL=["pentatonica_mayor","blues","por_tonos"];
/*******************************************************************/
/* Utilidades */
/*******************************************************************/
const roman=n=>({1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII",8:"VIII",9:"IX",10:"X",11:"XI",12:"XII",13:"XIII",14:"XIV",15:"XV",16:"XVI",17:"XVII",18:"XVIII",19:"XIX",20:"XX",21:"XXI",22:"XXII"}[n]||n);
const fretW=()=>BOARD_H/STRINGS*2;
const pcPat=(root,ints)=>{const arr=[root];for(let i=0;arr.length<12;i++)arr.push((arr.at(-1)+ints[i%ints.length])%12);return arr};
const pick=(pc,r,pcs,s)=>s?(pc===r?"#0f0":pcs.indexOf(pc)%3===0?"#08f":"#f80"):pc===r?"#0f0":[2,4,6].includes(pcs.indexOf(pc))?"#08f":[1,3,5].includes(pcs.indexOf(pc))?(pcs.includes((pc+11)%12)?"#f00":"#f80"):'#aaa';
/*******************************************************************/
/* DOM refs */
/*******************************************************************/
const $=id=>document.getElementById(id),rootSel=$("root"),scaleSel=$("scale"),posSel=$("pos"),minus=$("minus"),plus=$("plus"),fretVal=$("fretVal"),fretLabel=$("fretLabel"),cvs=$("board"),ctx=cvs.getContext("2d");
NOTE.forEach(n=>rootSel.add(new Option(n,n)));Object.keys(SCALE).forEach(k=>scaleSel.add(new Option(k.replace(/_/g,' '),k)));rootSel.value="C";
/*******************************************************************/
/* Core funciones */
/*******************************************************************/
function fit(){const w=visibleFrets*fretW(),dpr=window.devicePixelRatio||1;cvs.style.width=`${w}px`;cvs.style.height=`${BOARD_H}px`;cvs.width=w*dpr;cvs.height=BOARD_H*dpr;ctx.setTransform(dpr,0,0,dpr,0,0);} 
function updatePos(){posSel.innerHTML="";const rootPc=NOTE.indexOf(rootSel.value),ints=SCALE[scaleSel.value];STR_PITCH.forEach(sp=>{for(let f=0;f<TOTAL_FRETS;f++){const pc=(sp+f)%12;if(pc===rootPc&&![...posSel.options].some(o=>+o.value===f))posSel.add(new Option(roman(f+1),f));}});} 
function draw(){fit();const off=+posSel.value||0,fw=fretW(),fh=BOARD_H/STRINGS;ctx.clearRect(0,0,cvs.width,cvs.height);
  /* trastes */
  ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--grid');ctx.lineWidth=2; // ⬆︎ grosor visible
  for(let f=0;f<=visibleFrets;f++){ctx.beginPath();ctx.moveTo(f*fw,0);ctx.lineTo(f*fw,BOARD_H);ctx.stroke();}
  /* cuerdas */
  const widths=[3.5,3,2.5,2,1.5,1];ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--string');
  for(let s=0;s<STRINGS;s++){ctx.lineWidth=widths[s];const y=(STRINGS-1-s)*fh+fh/2;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(visibleFrets*fw,y);ctx.stroke();}
  /* notas */
  const rootPc=NOTE.indexOf(rootSel.value),pcs=pcPat(rootPc,SCALE[scaleSel.value]),spec=SPECIAL.includes(scaleSel.value);
  ctx.font=`${RAD}px Inter`;ctx.textAlign="center";ctx.textBaseline="middle";
  for(let s=0;s<STRINGS;s++)for(let f=0;f<visibleFrets;f++){const real=f+off,pc=(STR_PITCH[s]+real)%12;if(!pcs.includes(pc))continue;const x=f*fw+fw/2,y=(STRINGS-1-s)*fh+fh/2;ctx.save();ctx.shadowColor="rgba(0,0,0,.55)";ctx.shadowBlur=5;ctx.fillStyle=pick(pc,rootPc,pcs,spec);ctx.beginPath();ctx.arc(x,y,RAD,0,Math.PI*2);ctx.fill();ctx.restore();ctx.fillStyle="#000";ctx.fillText(NOTE[pc],x,y);}fretLabel.textContent=roman(off+1);} 
function refresh(){fretVal.textContent=visibleFrets;updatePos();draw();}
/*******************************************************************/
/* Eventos */
/*******************************************************************/
minus.onclick=()=>{if(visibleFrets>4){visibleFrets--;refresh();}};
plus.onclick=()=>{if(visibleFrets<22){visibleFrets++;refresh();}};
rootSel.onchange=refresh;scaleSel.onchange=refresh;posSel.onchange=draw;window.addEventListener('load',()=>{posSel.value=0;refresh();});
</script>
</body>
</html>
